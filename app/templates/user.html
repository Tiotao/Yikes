
<!-- extend base layout -->
{% extends "base.html" %}

{% block content %}

<script>
    $(window).load(function(){
        $('#HistoryTab a[href="#borrow"]').tab('show');
    });
</script>


{% include 'flash.html' %}
<div class="well well-large" style="height: 140px;">
    <div class="pull-right">
        <img src="{{user.avatar(128)}}" class="img-polaroid">
    </div>
    <h1>{{user.nickname}}</h1>
    {% if user.about_me %}<p>{{user.about_me}}</p>{% endif %}
    {% if user.last_seen %}<p><em>Last seen on: {{user.last_seen}}</em></p>{% endif %}
    <p><a href = "{{url_for('friends', nickname = user.nickname)}}">Friends: </a> |
    {% if user.id == g.user.id %}
        <a href="{{url_for('edit')}}">Edit your profile</a>
    {% elif not g.user.is_following(user) %}
        <a href="{{url_for('follow', nickname = user.nickname)}}">Follow</a>
    {% else %}
        <a href="{{url_for('unfollow', nickname = user.nickname)}}">Unfollow</a>
    {% endif %}
    </p>
</div>

<h1><small>History</small></h1>

<div id="history-content">
  <ul class="nav nav-pills" id = "HistoryTab">
    <li><a class = "active" href = "#borrow">Borrow</a></li>
    <li><a href = "#lend">Lend</a></li>
    <li><a href = "#incoming">Incoming Request 
        {% if number_req > 0 %}
        <span class="badge badge-warning">{{number_req}}</span>
        {% endif %}
        </a>
        </li>
  </ul>
    <div class = "tab-content">
        <div class = "tab-pane active" id = "borrow">
            {% for record in borrow_records.items %}
                {% include 'record.html' %}
            {% endfor %}

            <ul class="pager">
                {% if borrow_records.has_prev %}
                <li class="previous"><a href="{{ url_for('user', nickname = user.nickname, page = borrow_records.prev_num) }}">Newer History</a></li>
                {% else %}
                <li class="previous disabled"><a href="#">Newer History</a></li>
                {% endif %}
                {% if borrow_records.has_next %}
                <li class="next"><a href="{{ url_for('user', nickname = user.nickname, page = borrow_records.next_num) }}">Older History</a></li>
                {% else %}
                <li class="next disabled"><a href="#">Older History</a></li>
                {% endif %}
            </ul>
        </div>
        <div class = "tab-pane" id = "lend">
            {% for record in lend_records.items %}
                {% include 'record.html' %}
            {% endfor %}

            <ul class="pager">
                {% if lend_records.has_prev %}
                <li class="previous"><a href="{{ url_for('user', nickname = user.nickname, page = lend_records.prev_num) }}">Newer History</a></li>
                {% else %}
                <li class="previous disabled"><a href="#">Newer History</a></li>
                {% endif %}
                {% if lend_records.has_next %}
                <li class="next"><a href="{{ url_for('user', nickname = user.nickname, page = lend_records.next_num) }}">Older History</a></li>
                {% else %}
                <li class="next disabled"><a href="#">Older History</a></li>
                {% endif %}
            </ul>
        </div>
        <div class = "tab-pane" id = "incoming">
            {% for request in incoming_requests.items %}
                {% include 'request.html' %}
            {% endfor %}

            <ul class="pager">
                {% if incoming_requests.has_prev %}
                <li class="previous"><a href="{{ url_for('user', nickname = user.nickname, page = incoming_requests.prev_num) }}">Newer Request</a></li>
                {% else %}
                <li class="previous disabled"><a href="#">Newer Request</a></li>
                {% endif %}
                {% if incoming_requests.has_next %}
                <li class="next"><a href="{{ url_for('user', nickname = user.nickname, page = incoming_requests.next_num) }}">Older Requests</a></li>
                {% else %}
                <li class="next disabled"><a href="#">Older Requests</a></li>
                {% endif %}
            </ul>
        </div>
    </div>

    <script>

        $('#HistoryTab a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        })
    </script>

</div>


{% endblock %}
